{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}{{ title }} - e-Finance DAF{% endblock %}

{% block extra_css %}
<style>
    .releve-selection-card {
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        border-radius: 10px;
        overflow: hidden;
        max-width: 800px;
        margin: 0 auto;
    }
    
    .releve-selection-card .card-header {
        background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
        color: white;
        padding: 1.5rem;
        border-bottom: none;
    }
    
    .releve-selection-card .card-header h4 {
        margin: 0;
        font-weight: 600;
        font-size: 1.4rem;
    }
    
    .releve-info {
        background-color: #e3f2fd;
        border-left: 4px solid #2196f3;
        padding: 1rem;
        margin-bottom: 1.5rem;
        border-radius: 0 5px 5px 0;
    }
    
    .releve-list {
        max-height: 400px;
        overflow-y: auto;
    }
    
    .releve-item {
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 0.75rem;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .releve-item:hover {
        background-color: #f8f9fa;
        border-color: #007bff;
        transform: translateY(-1px);
    }
    
    .releve-item.selected {
        background-color: #e3f2fd;
        border-color: #2196f3;
    }
    
    .releve-banque {
        font-weight: 600;
        color: #1a3a5f;
        font-size: 1.1rem;
    }
    
    .releve-periode {
        color: #6c757d;
        font-size: 0.9rem;
    }
    
    .releve-solde {
        font-weight: 600;
        font-size: 1.1rem;
    }
    
    .solde-positif {
        color: #28a745;
    }
    
    .solde-negatif {
        color: #dc3545;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card releve-selection-card">
                <div class="card-header text-center">
                    <h4><i class="fas fa-file-invoice-dollar me-2"></i>{{ title }}</h4>
                    <p class="mb-0 mt-2">Sélectionnez un relevé de dépenses pour voir les demandes à payer</p>
                </div>
                <div class="card-body p-4">
                    <form method="post" id="releveForm">
                        {% csrf_token %}
                        <div class="mb-4">
                            <label for="{{ form.releve_depense.id_for_label }}" class="form-label fw-bold">
                                <i class="fas fa-file-invoice-dollar me-1"></i>
                                Relevés de dépenses disponibles
                            </label>
                            {{ form.releve_depense.errors }}
                            {{ form.releve_depense }}
                        </div>
                        
                        <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                            <a href="{% url 'demandes:paiement_liste' %}" class="btn btn-secondary me-md-2">
                                <i class="fas fa-arrow-left me-1"></i> Retour aux paiements
                            </a>
                            <button type="submit" class="btn btn-info">
                                <i class="fas fa-search me-1"></i> Voir les demandes à payer
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Informations supplémentaires -->
            <div class="mt-4">
                <div class="releve-info">
                    <h6><i class="fas fa-info-circle me-1"></i>Informations</h6>
                    <p class="mb-0">
                        Seuls les relevés bancaires validés et non archivés apparaissent dans cette liste. 
                        Un relevé est archivé automatiquement lorsque toutes les demandes associées ont été entièrement payées.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const releveSelect = document.getElementById('id_releve_bancaire');
    
    function updateRelevePreview() {
        const selectedOption = releveSelect.options[releveSelect.selectedIndex];
        if (releveSelect.value) {
            // Ajouter une classe pour indiquer la sélection
            releveSelect.classList.add('is-valid');
        } else {
            releveSelect.classList.remove('is-valid');
        }
    }
    
    releveSelect.addEventListener('change', updateRelevePreview);
    
    // Initialisation
    updateRelevePreview();
});
</script>
{% endblock %}
